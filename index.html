<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI 基金分析师</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<!-- HEADER -->
<header class="header">
  <div class="header-top">
    <div class="header-title">🤖 AI <span>基金分析师</span></div>
    <div class="status-bar">
      <span class="status-clock" id="clock">--:--:--</span>
      <span class="trade-badge" id="tradeBadge">--</span>
      <span id="statusMsg" style="color:#aac;font-size:.78rem"></span>
    </div>
  </div>
  <div class="timer-bar">
    <label>定时分析：</label>
    <select id="timerInterval">
      <option value="30">30分钟</option>
      <option value="60" selected>1小时</option>
      <option value="120">2小时</option>
    </select>
    <button class="btn-timer off" id="timerBtn" onclick="toggleTimer()">▶ 开启</button>
    <span class="next-time" id="nextTime"></span>
  </div>
</header>

<!-- MAIN -->
<div class="container">

  <!-- API KEY -->
  <div class="key-section">
    <details id="keyDetails">
      <summary>🔑 DeepSeek API Key 设置 <span class="key-status" id="keyStatus"></span></summary>
      <div class="key-row">
        <input type="password" id="apiKeyInput" placeholder="sk-xxxxxxxxxxxxxxxx" oninput="saveApiKey()">
        <span class="key-status" id="keyStatusInline"></span>
      </div>
    </details>
  </div>

  <!-- TEXT IMPORT -->
  <div class="ocr-section">
    <details>
      <summary>📋 粘贴文本批量导入基金</summary>
      <div class="ocr-body" style="flex-direction:column;align-items:stretch">
        <textarea id="ocrText" placeholder="粘贴持仓截图的文字内容，或直接输入包含基金代码的文本，系统会自动提取6位基金代码..." style="width:100%;height:80px;padding:10px;border:1.5px solid #d0d7de;border-radius:8px;font-size:.85rem;outline:none;resize:vertical;font-family:inherit"></textarea>
        <div style="display:flex;gap:8px;margin-top:8px;align-items:center;flex-wrap:wrap">
          <button class="btn-primary" onclick="parseTextImport()" style="padding:8px 16px;font-size:.85rem">🔍 提取并导入</button>
          <span class="ocr-result" id="ocrResult"></span>
        </div>
      </div>
    </details>
  </div>

  <!-- CTRL ROW -->
  <div class="ctrl-row">
    <div class="search-wrap">
      <input type="text" id="codeInput" placeholder="输入基金代码或名称搜索" maxlength="20"
        oninput="onSearchInput()" onkeydown="onSearchKey(event)">
      <div class="search-dropdown" id="searchDropdown"></div>
    </div>
    <button class="btn-primary" onclick="addFundFromInput()">+ 添加</button>
    <button class="btn-secondary" onclick="openEditModal(null)">📋 管理</button>
  </div>

  <!-- ANALYZE BUTTON -->
  <div class="analyze-wrap">
    <button class="btn-analyze" id="analyzeBtn" onclick="startAnalysis()">
      🧠 一键获取数据 &amp; AI深度分析
    </button>
  </div>

  <!-- STEPS -->
  <div class="steps" id="stepsRow" style="display:none">
    <div class="step" id="step0">
      <div class="step-circle">1</div>
      <div class="step-label">拉取数据</div>
    </div>
    <div class="step-line" id="line01"></div>
    <div class="step" id="step1">
      <div class="step-circle">2</div>
      <div class="step-label">计算指标</div>
    </div>
    <div class="step-line" id="line12"></div>
    <div class="step" id="step2">
      <div class="step-circle">3</div>
      <div class="step-label">AI分析</div>
    </div>
  </div>

  <!-- PROGRESS -->
  <div class="progress-wrap" id="progressWrap">
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    <div class="progress-text" id="progressText"></div>
  </div>

  <!-- SUMMARY BAR -->
  <div class="summary-bar">
    <div class="summary-item"><div class="summary-label">监控数</div><div class="summary-value" id="sumTotal">0</div></div>
    <div class="summary-item"><div class="summary-label">买入</div><div class="summary-value" id="sumBuy">0</div></div>
    <div class="summary-item"><div class="summary-label">持有</div><div class="summary-value" id="sumHold">0</div></div>
    <div class="summary-item"><div class="summary-label">卖出</div><div class="summary-value" id="sumSell">0</div></div>
    <div class="summary-item"><div class="summary-label">总盈亏</div><div class="summary-value summary-pnl" id="sumPnl">--</div></div>
  </div>

  <!-- FUND CARDS -->
  <div class="cards" id="cardsContainer">
    <div class="empty-state"><div class="icon">📊</div><div>暂无基金，请添加代码</div></div>
  </div>

  <!-- AI PANEL -->
  <div class="ai-panel" id="aiPanel" style="display:none;margin-top:16px">
    <div class="ai-header">🤖 AI 深度分析报告</div>
    <div class="ai-content" id="aiContent"></div>
  </div>

</div>

<!-- EDIT MODAL -->
<div class="modal-overlay" id="modalOverlay" style="display:none" onclick="closeModal(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <h3 id="modalTitle">编辑持仓</h3>
    <label>基金代码</label>
    <input type="text" id="mCode" readonly style="background:#f5f5f5;color:#888">
    <label>基金名称</label>
    <input type="text" id="mName" readonly style="background:#f5f5f5;color:#888">
    <label>持仓金额 (元)</label>
    <input type="number" id="mAmount" placeholder="0" min="0" step="100">
    <label>成本净值</label>
    <input type="number" id="mCost" placeholder="0.0000" step="0.0001" min="0">
    <div class="modal-actions">
      <button class="btn-sm danger" onclick="removeFund()">删除</button>
      <button class="btn-sm cancel" onclick="closeModal()">取消</button>
      <button class="btn-sm primary" onclick="saveModal()">保存</button>
    </div>
  </div>
</div>

<!-- BATCH TOOLBAR -->
<div class="batch-toolbar" id="batchToolbar">
  <span id="batchCount">已选 0 只</span>
  <button class="btn-sm primary" onclick="toggleSelectAll()">全选 / 取消全选</button>
  <button class="btn-sm danger" onclick="batchDelete()">🗑 批量删除</button>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script src="js/app.js"></script>
<script src="js/data.js"></script>
<script src="js/analysis.js"></script>
<script src="js/chart.js"></script>
<script src="js/ui.js"></script>
</body>
</html>
