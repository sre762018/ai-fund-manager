# AI 基金分析师 (ai-fund-manager)

> 一款基于 DeepSeek AI 的基金分析工具，无需后端，纯前端运行，数据实时拉取自东方财富/天天基金。

---

## 📁 项目结构

```
ai-fund-manager/
├── index.html          # HTML 页面结构
├── css/
│   └── style.css       # 所有样式
└── js/
    ├── app.js          # 主逻辑（状态、初始化、基金管理、搜索、定时器、工具函数）
    ├── data.js         # 数据获取（JSONP、fetchRealtime、fetchHistory）
    ├── analysis.js     # 指标计算、评分、AI 分析
    ├── chart.js        # Canvas 走势图绘制
    └── ui.js           # UI 渲染（renderCards、buildCard、updateSummary、modal 等）
```

---

## ✨ 功能特性

### 基金管理
- 输入 6 位基金代码直接添加，或按名称搜索（JSONP 实时搜索）
- 搜索名称时点击「+ 添加」按钮会自动选中下拉列表第一项
- 预设基金：015740 / 017470 / 161226 / 023551
- 可编辑每只基金的**持仓金额**与**成本净值**，实时计算盈亏
- 数据持久化到 `localStorage`，刷新不丢失

### 批量管理（基金卡片）
- 每张卡片左上角有复选框，可多选基金
- 选中任意基金后，底部出现**批量管理工具栏**，固定在屏幕底部
  - 显示已选数量
  - **全选 / 取消全选** 按钮
  - 🗑 **批量删除** 按钮（带确认弹窗）

### 数据获取（纯前端，无跨域）
- **实时估值**：通过 JSONP 拉取天天基金实时估算净值（`fundgz.1234567.com.cn`）
- **历史净值**：加载东方财富 pingzhongdata JS 文件，提取全量净值曲线（`fund.eastmoney.com`）
- **基金搜索**：东方财富搜索 API，支持代码/名称模糊匹配
- 所有请求串行处理，script 标签加载，12 秒超时自动清理

### 技术指标计算
| 指标 | 说明 |
|------|------|
| 日涨跌 | 最新净值与前日之差 |
| 区间涨跌 | 所选周期首尾涨跌幅 |
| 近 3 / 5 日 | 短期动量 |
| 连续天数 | 连涨/连跌天数（含方向） |
| ROC | 5 日变化率 |
| 波动率 | 日收益率标准差 |
| MA5 / MA20 | 5 日 / 20 日均线 |
| 综合评分 | 多维加权评分，驱动买卖建议 |

**评分公式：**
```
score = 区间涨跌×0.35 + 近5日×0.25 + 连续天数×方向×0.8 + ROC×0.15
MA5 > MA20 加 0.5，否则减 0.5
```

| 评分区间 | 建议 | 卡片左边框颜色 | 操作提示 |
|---------|------|--------------|---------|
| < -6 | 强烈加仓 | 深绿 `#1b5e20` | 建议操作：加仓 30%~50% |
| -6 ~ -3 | 买入 | 浅绿 `#388e3c` | 建议操作：加仓 10%~20% |
| -3 ~ 3 | 观望 | 橙色 `#f57c00` | 建议操作：维持现仓 |
| 3 ~ 6 | 卖出 | 红色 `#c62828` | 建议操作：减仓 10%~20% |
| > 6 | 大幅减仓 | 深红 `#880e4f` | 建议操作：减仓 20%~30% |

买卖建议徽章更大更醒目（字号 1rem，内边距 8px 20px），卡片左侧有彩色边框，建议行背景轻微着色。

### AI 深度分析（DeepSeek）
- 调用 `deepseek-chat` 模型，流式实时输出分析报告
- 包含：大盘环境判断 → 逐只基金分析 → 组合建议 → 今日操作清单
- API Key 由用户自行输入（password 输入框），保存在 `localStorage`，**不写死不上传**
- 未设置 Key 时跳过 AI 分析，数据拉取仍正常进行

### 图表
- Canvas 绘制走势图，支持 `devicePixelRatio` 高清适配
- MA5（黄色虚线）/ MA20（蓝色虚线）/ 净值曲线（涨红跌绿）
- 渐变面积图 + 终点圆点

### 周期切换
1周 / 1月（默认）/ 3月 / 6月，切换仅重渲染，不重新拉取数据

### 定时分析
- 顶部状态栏显示时钟、下次运行倒计时、交易状态
- 间隔：30 分钟 / 1 小时 / 2 小时可选
- 开关按钮一键启停

### 文本批量导入
- 粘贴包含基金代码的文字（如持仓截图文字），自动提取所有 6 位基金代码并批量导入
- 同时尝试提取代码后跟随的金额自动填入持仓

### 响应式设计
- **移动端（≤600px）**：指标 2 列，卡片头上下布局，按钮高度 ≥44px
- **桌面端**：960px 居中，指标 auto-fit 网格

---

## 🚀 部署说明

本项目为**纯静态多文件**，无需任何构建工具或后端服务。

### 方式一：本地开发（推荐使用本地服务器）
```bash
# Python 3
python -m http.server 8080
# 然后访问 http://localhost:8080
```
> ⚠️ 直接用 `file://` 协议打开时，`<script src="...">` 加载外部文件可能受浏览器安全限制，推荐用本地服务器。

### 方式二：GitHub Pages
1. Fork 本仓库
2. 进入 Settings → Pages
3. Source 选择 `main` 分支 / `/ (root)`
4. 访问 `https://<your-name>.github.io/ai-fund-manager/`

### 方式三：任意静态托管
将整个仓库（`index.html` + `css/` + `js/` 目录）部署到 Vercel、Netlify、Cloudflare Pages 等任意静态托管平台。

---

## 🔑 DeepSeek API Key 获取

1. 前往 [https://platform.deepseek.com](https://platform.deepseek.com) 注册账号
2. 在 API Keys 页面创建密钥（格式：`sk-xxxxxxxx`）
3. 在工具顶部「🔑 DeepSeek API Key 设置」中粘贴并保存

Key 仅保存在本地浏览器的 `localStorage`，不会上传到任何服务器。

---

## 📖 使用方法

1. **添加基金**：在输入框输入 6 位代码（如 `015740`）或搜索名称，点击「+ 添加」
2. **设置持仓**：点击卡片右上角 ✏️ 图标，填写持仓金额和成本净值
3. **批量删除**：勾选多张卡片左上角的复选框，在底部工具栏点击「🗑 批量删除」
4. **一键分析**：点击「🧠 一键获取数据 & AI深度分析」按钮，等待三步完成
5. **查看报告**：AI 分析报告流式输出在页面底部
6. **定时分析**：在顶部选择间隔，点击「▶ 开启」自动定时执行
7. **文本导入**：展开「📋 粘贴文本批量导入基金」，粘贴含基金代码的文字，点击「🔍 提取并导入」

---

## ⚠️ 免责声明

- 本工具仅供学习和参考，**不构成任何投资建议**
- AI 生成内容可能存在偏差，投资决策请结合自身判断
- 基金投资有风险，入市需谨慎
- 作者不对因使用本工具产生的任何损失承担责任
- 本工具不存储任何用户数据，所有数据均在本地处理

---

## 🛠️ 技术栈

- 纯原生 HTML5 + CSS3 + JavaScript（ES2020+）
- 无任何第三方依赖，无构建工具
- Canvas 2D API 绘图
- Fetch API + ReadableStream 流式输出
- JSONP 跨域数据获取
- localStorage 数据持久化

---

## 📄 License

MIT
